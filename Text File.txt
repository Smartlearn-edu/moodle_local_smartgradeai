

Thought for 10s












For the new API, it is highly recommended to use JSON format because sending a list (the rubric criteria) using the old bracket style (rubric_data[0][id]...) is very messy in n8n.

Here is exactly how to configure your n8n HTTP Request node:

1. HTTP Request Node Configuration
Method: POST
https://smartlearn.education/webservice/rest/server.php
Authentication: Generic Credential Type (Query Auth) or however you assume the token.
Send Body: true
Body Content Type: JSON
Specify Body: Using JSON
2. The JSON Payload
In wstoken, put your actual token.

json
{
  "wstoken": "f6654656456456456",
  "wsfunction": "local_smartgradeai_save_rubric_grade",
  "moodlewsrestformat": "json",
  "assignmentid": 34,
  "userid": 5,
  "rubric_data": [
    {
      "criterionid": 11,
      "levelid": 33,
      "remark": "This is feedback for the first row."
    },
    {
      "criterionid": 12,
      "levelid": 37,
      "remark": "This is feedback for the second row."
    }
  ]
}
Key Differences from the Old Way
No "grade" parameter: You do not send a number (like 44). Moodle calculates the score automatically based on the levelid you chose for each criterion.
Structure: Instead of plugindata[...], we use a clean list called rubric_data.
Important: After Deploying Code
Since we added a new function, you must:

Go to Site Administration > Notifications to run the plugin update (to register the new version).
Go to Site Administration > Server > Web services > External services.
Click Functions for the service your token belongs to.
Add function: Search for local_smartgradeai_save_rubric_grade and add it. (If you are using an admin token/service, this might happen automatically, but always check).
 
